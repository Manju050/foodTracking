


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Counter Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</head>

{% if no_active_session %}
  <div class="alert alert-warning text-center fw-bold">
    No active session is currently set.<br/>
    Please wait until a new session is activated or try again later.
  </div>
{% else %}

<body>
  <div class="container my-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h1 class="text-success mb-0">My Counter Dashboard</h1>
      <a href="{{ url_for('logout') }}" class="btn btn-outline-danger">
        <i class="bi bi-box-arrow-right"></i> Logout
      </a>
    </div>
{% if active_session %}
  <div class="alert alert-info">
    Current Active Session: <strong>{{ active_session.session_name }}</strong>  </div>
{% else %}
  <div class="alert alert-warning">
    No active session currently set.
  </div>
{% endif %}

    <!-- Counter selector dropdown -->
    <form method="get" action="{{ url_for('home') }}" class="mb-4">
      <label for="counterSelect" class="form-label fw-semibold">Select Counter</label>
      <select id="counterSelect" name="counter_id" class="form-select" onchange="this.form.submit()" required>
        <option value="" disabled {% if not counter %}selected{% endif %}>Choose your counter</option>
        {% for c in counters %}
          <option value="{{ c.id }}" {% if counter and c.id == counter.id %}selected{% endif %}>{{ c.name }}</option>
        {% endfor %}
      </select>
      <noscript><button type="submit" class="btn btn-primary mt-2">Load Counter</button></noscript>
    </form>

    {% if counter %}
      <h3>Counter: {{ counter.name }}</h3>

<form method="post" action="{{ url_for('update_available_stock', counter_id=counter.id, session_id=active_session.id) }}">
  <table class="table table-bordered table-hover">
    <thead class="table-light">
      <tr>
        <th>Item Name</th>
        <th>Available Stock With Me</th>
        <th>Update Available Stock</th>
      </tr>
    </thead>
    <tbody>
      {% for item in items %}
      <tr>
        <td>{{ item.item_name }}</td>
        <td>{{ item.available_stock or 0 }}</td>
        <td>
          <input 
            type="number" 
            name="available_stock_{{ item.id }}" 
            value="{{ item.available_stock or 0 }}" 
            min="0" 
            style="width:90px;" 
            required 
            class="form-control"
          >
        </td>
      </tr>
      {% else %}
      <tr>
        <td colspan="3" class="text-center">No items found. Please add new items.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <button type="submit" class="btn btn-primary">Update Stocks</button>
</form>

    {% else %}
      <p class="text-muted">Please select a counter to manage its available stock.</p>
    {% endif %}
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

{% endif %}
</html>
